# 11. ë¡œê¹…: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë™ì‘ ê¸°ë¡

ì„œë¹„ìŠ¤ì— ê¸°ëŠ¥ì´ ëŠ˜ì–´ë‚˜ê³  ì‚¬ì´ì¦ˆê°€ ì»¤ì§€ê²Œ ë˜ë©´ ë™ì‘ ê³¼ì •ì„ ë‚¨ê¸°ê³  ì¶”ì í•˜ëŠ” ì¼ì´ ì¤‘ìš”í•˜ê²Œã… ëœë‹¤. 

ì´ìŠˆê°€ ë°œìƒí–ˆì„ ê²½ìš° ì´ìŠˆ ì¦ìƒë§Œìœ¼ë¡œ ì›ì„ íŒŒì•…í•˜ëŠ”ë°ì—ëŠ” ì‹œê°„ê³¼ ë…¸ë ¥ì´ ë§ì´ ë“¤ê³  ì½”ë“œë¥¼ ë‹¤ì‹œ ì—­ì¶”ì í•˜ë©´ì„œ ì´í•´í•˜ëŠ” ë°ì— ì–´ë ¤ì›€ì´ ë”°ë¥¸ë‹¤. 

ì´ìŠˆê°€ ë°œìƒí•œ ì§€ì ê³¼ ì½œ ìŠ¤íƒì´ í•¨ê»˜ ì œê³µê´¸ë‹¤ë©´ ë¹¨ë¦¬ í•´ê²°ì´ ê°€ëŠ¥í•  ê²ƒì´ë‹¤. 

ë˜ ì–´ë–¤ ê¸°ì´ ë§ì´ ì‚¬ìš©ë˜ëŠ”ì§€ì™€ ê°™ã…Œì´ ìœ ì €ì˜ ì‚¬ìš© íŒ¨í„´ì„ ë¶„ì„í•˜ëŠ” ë°ì—ë„ ë¡œê·¸(log)ë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤. 

ì´ë²ˆ ì¥ì—ì„œëŠ” Nestì—ì„œ ì œê³µí•˜ëŠ” ë‚´ì¥ ë¡œê±°ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ê² ë‹¤. 

ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©´ ì„œë²„ ì½˜ì†”ì—ëŠ” ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì€ ë¡œê·¸ê°€ ì¶œë ¥ëœë‹¤. 

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2023-10-30 á„‹á…©á„’á…® 5.10.05.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/380da689-6e0b-4496-b9c4-07070d4b592a/098639d8-6fa2-45ab-98bf-9cd05a361922/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-10-30_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.10.05.png)

ë‚´ì¥ Logger í´ë˜ìŠ¤ëŠ” @nest/common íŒ¨í‚¤ì§€ë¡œ ì œê³µëœë‹¤. 

ë¡œê¹… ì˜µì…˜ì„ ì¡°ì ˆí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¡œê¹… ì‹œìŠ¤í…œì˜ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤. 

- ë¡œê¹… ë¹„í™œì„±í™”
- ë¡œê·¸ ë ˆë²¨ ì§€ì •: log, error, warn, debug, verbos
- ë¡œê±°ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ ì¬ì •ì˜. ì˜ˆ) ë‚ ì§œë¥¼ ISO8601 í˜•ì‹ìœ¼ë¡œ ë³€ê²½
- ê¸°ë³¸ ë¡œê±°ë¥¼ ì¬ì •ì˜(ì˜¤ë²„ë¼ì´ë”©)
- ê¸°ë³¸ ë¡œê±°ë¥¼ í™•ì¥í•´ì„œ ì»¤ìŠ¤í…€ ë¡œê±°ë¥¼ ì‘ì„±
- ì˜ì¡´ì„± ì£¼ì…ì„ í†µí•´ ì†ì‰½ê²Œ ë¡œê±°ë¥¼ ì£¼ì…í•˜ê±°ë‚˜ í…ŒìŠ¤íŠ¸ ëª¨ë“ˆë¡œ ì œê³µ

## 11.1 ë‚´ì¥ ë¡œê±°

ë‚´ì¥ ë¡œê±°ì˜ ì¸ìŠ¤í„´ìŠ¤ëŠ” ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³ ì í•˜ëŠ” ë¶€ë¶„ì—ì„œ ì§ì ‘ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

ëª¨ë“  ë¡œê·¸ ë ˆë²¨ì˜ ë¡œê·¸ë¥¼ ì¶œë ¥í•´ë³´ì

```tsx
import { Injectable, Logger } from '@nestjs/common';
import { MyLogger } from './logging/my-logger.service';

@Injectable()
export class AppService {
  constructor(private myLogger: MyLogger) { }

  private readonly logger = new Logger(AppService.name);

  getHello(): string {
		this.logger.error('level: error');
    this.logger.warn('level: warn');
    this.logger.log('level: log');
    this.logger.verbose('level: verbose');
    this.logger.debug('level: debug');

    return 'Hello World!';
  }
}
```

ë¡œê±°ë¥¼ ìƒì„±í•  ë•Œ ì–´ëŠ ì½˜í…ìŠ¤íŠ¸ì—ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ”ì§€ ì´ë¦„ì„ ì¤„ ìˆ˜ ìˆë‹¤. 

ì´ ì½”ë“œë¥¼ ìˆ˜í–‰í•˜ë©´ ì½˜ì†”ì—ëŠ” ë‹¤ìŒì²˜ëŸ¼ ë¡œê·¸ê°€ ì¶œë ¥ëœë‹¤. 

![á„‹á…µá„†á…µá„Œá…µ 2023. 10. 30. á„‹á…©á„’á…® 5.38.jpeg](https://prod-files-secure.s3.us-west-2.amazonaws.com/380da689-6e0b-4496-b9c4-07070d4b592a/7c6848a0-3cf2-40eb-8208-7e298f504417/%E1%84%8B%E1%85%B5%E1%84%86%E1%85%B5%E1%84%8C%E1%85%B5_2023._10._30._%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.38.jpeg)

ì„¤ì •í•œ ì½˜í…ìŠ¤íŠ¸ê°€  AppServiceë¡œ í•¨ê»˜ ì¶œë ¥ë˜ê³  ìˆë‹¤. 

ë¡œê·¸ íŒŒì¼ì„ ë¶„ì„í•  ë•Œ íŠ¹ì • ì½˜í…ìŠ¤íŠ¸ì—ì„œ ë°œìƒí•œ ë¡œê·¸ë§Œ í•„í„°ë§í•˜ê³ ì í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 

### 11.1.1 ë¡œê¹… ë¹„í™œì„±í™”

NestFactory.create ë©”ì„œë“œì˜ NestApplicationOptionsì— ë¡œê¹…ì„ í™œì„±í™”í•˜ëŠ” logger ì˜µì…˜ì´ ìˆë‹¤.

ì´ë¥¼ falseë¡œ ì§€ì •í•˜ë©´ ë¡œê·¸ê°€ ì¶œë ¥ë˜ì§€ ì•ŠëŠ”ë‹¤.

```tsx
...
  const app = await NestFactory.create(AppModule, {
    logger: false,
  });
  await app.listen(3000);
...
```

### 11.1.2

ì¼ë°˜ì ìœ¼ë¡œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” debugë¡œê·¸ê°€ ë‚¨ì§€ ì•Šë„ë¡ í•˜ëŠ”ê²Œ ì¢‹ë‹¤. 

ë””ë²„ê·¸ ë¡œê·¸ëŠ” í…ŒìŠ¤íŠ¸ ì •ì—ì„œ ë””ë²„ê¹…ìš©ìœ¼ë¡œ ê°ì²´ê°€ ê°€ì§€ê³  ìˆëŠ” ì„¸ë¶€ ë°ì´í„°ê¹Œì§€ ë‚¨ê¸°ëŠ” ê²½ìš°ê°€ ë§ì•„ ì‚¬ìš©ìì˜ ë¯¼ê° ì •ë³´ê°€ í¬í•¨ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤. 

ë””ë²„ê¹… ë¡œê·¸ëŠ” ë¡œê·¸ì˜ í¬ê¸° ìì²´ë„ í° ê²½ìš°ê°€ ëŒ€ë¶€ë¶„ì´ë¯€ë¡œ ë¡œê·¸ íŒŒì¼ì˜ ì‚¬ì´ì¦ˆë¥¼ ì¤„ì´ê¸° ìœ„í•œ ëª©ì ë„ ìˆë‹¤. 

ë‹¤ìŒê³¼ ê°™ì´ ì‹¤í–‰ í™˜ê²½ì— ë”°ë¼ ë¡œê·¸ ë ˆë²¨ì„ ì§€ì •í•˜ëŠ” ê²½ìš°ê°€ ë³´í†µì´ë‹¤. 

```tsx
const app = await NestFactory.create(AppModule, {
  logger: process.env.NODE_ENV === 'production'
    ? ['error', 'warn', 'log']
    : ['error', 'warn', 'log', 'verbose', 'debug']
});
```

<aside>
ğŸ’¡ ë¡œê·¸ë ˆë²¨ì„ í•˜ë‚˜ë§Œ ì„¤ì •í•œë‹¤ë©´ í•´ë‹¹ ë ˆë²¨ë³´ë‹¤ ìˆ«ìê°€ í° ë ˆë³„ì˜ ë¡œê·¸ë„ ëª¨ë‘ í•¨ê»˜ ì¶œë ¥ëœë‹¤. 
ë”°ë¼ì„œ debugë¡œë§Œ ì„¤ì •í•œë‹¤ë©´ ëª¨ë“  ë¡œê·¸ê°€ ì¶œë ¥ëœë‹¤. 
ë¡œê·¸ ë ˆë²¨ì˜ ì •ì˜ëŠ” [Nest ì†ŒìŠ¤ ì½”ë“œ](https://github.com/nestjs/nest/blob/master/packages/common/services/utils/is-log-level-enabled.util.ts#L3)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```tsx
// https://github.com/nestjs/nest/blob/master/packages/common/services/utils/is-log-level-enabled.util.ts#L3
const LOG_LEVEL_VALUES: Record<LogLevel, number> = {
  verbose: 0,
  debug: 1,
  log: 2,
  warn: 3,
  error: 4,
  fatal: 5,
};
```

</aside>

## 11.2 ì»¤ìŠ¤í…€ ë¡œê±°

ë¡œê·¸ ë¶„ì„ì„ ìœ„í•´ì„œëŠ” ì–´ë–¤ í˜•íƒœë“  ë¡œê·¸ë¥¼ ì €ì¥í•´ë‘ê³  ê²€ìƒ‰ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•˜ëŠ”ë° ë‚´ì¥ ë¡œê±°ëŠ” íŒŒì¼ì´ë‚˜ ë°ì´í„° ë² ì´ìŠ¤ë¡œ ì €ì¥í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤. 

ì´ë¥¼ ìœ„í•´ì„œëŠ” ì»¤ìŠ¤í…€ ë¡œê±°ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤. 

ì»¤ìŠ¤í…€ ë¡œê±°ëŠ” @nestjs/common íŒ¨í‚¤ì§€ì˜ LoggerService ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤. 

```tsx
export interface LoggerService {
    log(message: any, ...optionalParams: any[]): any;
    error(message: any, ...optionalParams: any[]): any;
    warn(message: any, ...optionalParams: any[]): any;
    debug?(message: any, ...optionalParams: any[]): any;
    verbose?(message: any, ...optionalParams: any[]): any;
    fatal?(message: any, ...optionalParams: any[]): any;
    setLogLevels?(levels: LogLevel[]): any;
}
```

ì»¤ìŠ¤í…€ ë¡œê±° MyLogger ë§Œë“¤ê¸°

```tsx
//my-logger.service.ts
export class MyLogger implements LoggerService {
  log(message: any, ...optionalParams: any[]) {
    console.log(message);
  }
  error(message: any, ...optionalParams: any[]) {
    console.log(message);
  }
  warn(message: any, ...optionalParams: any[]) {
    console.log(message);
  }
  debug?(message: any, ...optionalParams: any[]) {
    console.log(message);
  }
  verbose?(message: any, ...optionalParams: any[]) {
    console.log(message);
  }
}
```

ë‚´ì¥ ë¡œê±° ëŒ€ì‹  MyLoggerê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë¡œê·¸ë¥¼ ì¶œë ¥í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¡°ê¸ˆì€ ë°‹ë°‹í•˜ê²Œ í…ìŠ¤íŠ¸ë§Œ ì¶œë ¥ëœë‹¤. 

ë‚´ì¥ ë¡œê±°ì™€ ê°™ì´ í”„ë¡œì„¸ìŠ¤ ID, ë¡œê¹… ì‹œê°„, ë¡œê·¸ ë ˆë²¨(ì»¬ëŸ¬), ì½˜í…ìŠ¤íŠ¸ ì´ë¦„ ë“±ì„ í•¨ê»˜ ì¶œë ¥í•˜ë ¤ë©´ ì§ì ‘ ê° í•¨ìˆ˜ ë‚´ì— ì¶œë ¥ ë©”ì‹œì§€ë¥¼ êµ¬ì„±í•´ì•¼ í•œë‹¤. 

ê·¸ë˜ì„œ ì´ë ‡ê²Œ ì²˜ìŒë¶€í„° ì‘ì„±í•˜ê¸° ë³´ë‹¤ëŠ”, ConsoleLoggerë¥¼ ìƒì†ë°›ìœ¼ë©´ ë” ë‚«ë‹¤.

```tsx
export class MyLogger extends ConsoleLogger {
  log(message: any, stack?: string, context?: string) {
    super.log.apply(this, arguments);
    this.doSomething();
  }

  private doSomething() {
    // ì—¬ê¸°ì— ë¡œê¹…ì— ê´€ë ¨ëœ ë¶€ê°€ ë¡œì§ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
    // ex. DBì— ì €ì¥    
  }

...
}
```

### 11.2.1 ì»¤ìŠ¤í…€ ë¡œê±° ì£¼ì…í•´ì„œ ì‚¬ìš©í•˜ê¸°

ì§€ê¸ˆê¹Œì§€ëŠ” ë¡œê±°ë¥¼ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ê²ƒì—ì„œ ë§¤ë²ˆ newë¡œ ìƒì„±í–ˆë‹¤. 

ì´ì „ì— ë°°ì› ë˜ ê²ƒì²˜ëŸ¼ ë¡œê±°ë¥¼ ëª¨ë“ˆë¡œ ë§Œë“¤ë©´ ìƒì„±ìì—ì„œ ì£¼ì…ë°›ì„ ìˆ˜ ìˆë‹¤. 

ë¨¼ì € LoggerModuleì„ ë§Œë“¤ê³  AppModuleì— ê°€ì ¸ì˜¨ë‹¤.

```tsx
//logger.module.ts
import { Module } from '@nestjs/common';
import { MyLogger } from './my-logger.service';

@Module({
  providers: [MyLogger],
  exports: [MyLogger],
})
export class LoggerModule { }
```

```tsx
//app.module.ts
...
import { LoggerModule } from './logging/logger.module';

@Module({
  imports: [LoggerModule],
	...
})
export class AppModule { }
```

ì´ì œ  MyLogger í”„ë¡œë°”ì´ë”ë¥¼ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•œë‹¤.

```tsx
//app.service.ts
import { MyLogger } from './logging/my-logger.service';

@Injectable()
export class AppService {
  constructor(private myLogger: MyLogger) { }

  getHello(): string {
    this.myLogger.error('level: error');
    this.myLogger.warn('level: warn');
    this.myLogger.log('level: log');
    this.myLogger.verbose('level: verbose');
    this.myLogger.debug('level: debug');

    return 'Hello World!';
  }
```

### 11.2.2 ì»¤ìŠ¤í…€ ë¡œê±°ë¥¼ ì „ì—­ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸°

ì»¤ìŠ¤í…€ ë¡œê±°ë¥¼ ì „ì—­ìœ¼ë¡œ ì‚¬ìš©í•˜ë ¤ë©´ main.tsì— ì§€ì •í•´ì¤˜ì•¼ í•œë‹¤. 

ì´ë ‡ê²Œ í•˜ë©´ ì„œë¹„ìŠ¤ ë¶€íŠ¸ìŠ¤íŠ¸ë˜í•‘ ê³¼ì •ì—ì„œë„ í„°ìŠ¤í…€ ë¡œê±°ê°€ ì‚¬ìš©ëœë‹¤. 

```tsx
async function bootstrap(){
	const app = await NestFactory.create(AppModule);
	app.useLogger(app.get(MyLogger));
  await app.listen(3000);
}
bootstrap();
```

### 11.2.3 ì™¸ë¶€ ë¡œê±° ì‚¬ìš©í•˜ê¸°

ìƒí”„ë¡œì íŠ¸ì—ëŠ” ìœ„ì™€ ê°™ì€ ì»¤ìŠ¤í…€ ë¡œê±°ë¥¼ ë§¤ìš° ì •êµí•˜ê²Œ ë‹¤ë“¬ì–´ ì‚¬ìš©í•´ì•¼ í•  ê²ƒì´ë‹¤. 

í•˜ì§€ë§Œ Node.jsì—ëŠ” ì´ë¯¸ í›Œë¥­í•œ ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ winstonì´ ìˆë‹¤.

ë‚˜ì•„ê°€ winstonì„ Nestì˜ ëª¨ë“ˆë¡œ ë§Œë“¤ì–´ ë†“ì€ nest-winston íŒ¨í‚¤ì§€ê°€ ì¡´ì¬í•œë‹¤.

ìœ ì € ì„œë¹„ìŠ¤ì— nest-sinstonì„ ì´ìš©í•˜ì—¬ ë¡œê¹… ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ê² ë‹¤.


## 11.3 ìœ ì € ì„œë¹„ìŠ¤ì— winstonë¡œê±° ì ìš©í•˜ê¸°
